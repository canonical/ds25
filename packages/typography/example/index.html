<!doctype html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <title>CodePen Demo</title>

    <meta name="robots" content="noindex" />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200..800;1,200..800&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap");

      :root {
        /* base */
        --font-size: 32px;

        /* Given or set via external means */
        --baseline-height: 0.6rem;

        /* Raw font metrics as integers (dimensionless) */
        --ascender: 940;
        --descender: -240;
        --units-per-em: 1000;

        /* Agnostic values */
        --natural-line-height: calc((var(--ascender) - var(--descender)));
        --line-height-scale: calc(
          var(--natural-line-height) * 1rem / var(--units-per-em)
        );
        --ascender-scale: calc(var(--ascender) * 1rem / var(--units-per-em));
      }

      :root {
        /* Derived values */
      }

      html {
        font-size: var(--font-size);
        height: 100%;
        font-family: "Lato";
      }

      body {
        height: 100%;
        margin: 0;
      }
      main {
        background-image: linear-gradient(
          to bottom,
          #df1f00 1px,
          transparent 1px
        );
        background-size: 100% var(--baseline-height);
        background-position: 0 1px;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      p {
        margin: 0;
      }

      h1,
      h2,
      h3,
      h4,
      p {
        line-height: var(
          --line-height,
          calc(var(--baseline-height) * var(--line-height-multiple))
        );
        font-size: var(--font-size);
        background: #fededebb;

        --line-height-scale: calc(
          var(--natural-line-height) * var(--font-size) / var(--units-per-em)
        );
        --ascender-scale: calc(
          var(--ascender) * var(--font-size) / var(--units-per-em)
        );

        --baseline-position: calc(
          ((var(--line-height) - var(--line-height-scale)) / 2) +
            var(--ascender-scale)
        );
        /*--top-nudge: 0.41em;*/
        --top-nudge: calc(
          var(--baseline-height) -
            mod(var(--baseline-position), var(--baseline-height))
        );
        --bottom-nudge: calc(var(--baseline-height) - var(--top-nudge));
        padding-top: var(--top-nudge);
        margin-bottom: var(--bottom-nudge);
      }

      p {
        --font-size: 1rem;
        --line-height: 2.4rem;
      }

      h1 {
        --line-height: calc(var(--baseline-height) * 10);
        --font-size: 4.2rem;
      }

      h2 {
        --line-height: calc(var(--baseline-height) * 8);
        --font-size: 3.3rem;
      }

      h3 {
        --line-height: calc(var(--baseline-height) * 6);
        --font-size: 2.7rem;
      }

      h4 {
        --line-height: calc(var(--baseline-height) * 3);
        --font-size: 1.7rem;
      }

      .controls {
        display: flex;
        gap: 1rem;
        background: #f0f0f0;
        padding: 1rem;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .control {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      label {
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
      }
      input[type="range"] {
        width: 200px;
      }
    </style>
  </head>

  <body>
    <div class="controls">
      <div class="control">
        <label for="h1-font-size">H1 Font Size</label>
        <input
          type="range"
          id="h1-font-size"
          min="2"
          max="6"
          step="0.1"
          value="4.2"
        />
      </div>
      <div class="control">
        <label for="h1-line-height">H1 Line Height</label>
        <input
          type="range"
          id="h1-line-height"
          min="1"
          max="10"
          step="0.6"
          value="10"
        />
      </div>
      <div class="control">
        <label for="p-font-size">P Font Size</label>
        <input
          type="range"
          id="p-font-size"
          min="0.8"
          max="2"
          step="0.1"
          value="1"
        />
      </div>
      <div class="control">
        <label for="p-line-height">P Line Height</label>
        <input
          type="range"
          id="p-line-height"
          min="1.5"
          max="4"
          step="0.6"
          value="2.4"
        />
      </div>
    </div>
    <main>
      <p>This is a text aligned on the baseline</p>
      <p>Another paragraph</p>
      <p>Another paragraph</p>
      <h3>This is a H3 aligned on the grid</h3>
      <p>Another paragraph</p>
      <h1>This is a title aligned on the grid</h1>
      <p>Another paragraph</p>
      <h1>Another title</h1>
      <p>Another piece of content</p>
      <h2>A h2 title - it should not shift the alignment</h2>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam
        scelerisque, nunc nec lacinia ultricies, nunc nunc ultricies sapien, nec
        lacinia sapien nunc nec nunc. Nullam scelerisque, nunc nec lacinia
        ultricies, nunc nunc ultricies sapien, nec lacinia sapien nunc nec nunc.
        Nullam scelerisque, nunc nec lacinia ultricies, nunc nunc ultricies
        sapien, nec lacinia
      </p>
      <h4>Test of h4</h4>
    </main>

    <script>
      function updateCSSVariableForSelector(
        element,
        selector,
        property,
        unit = "rem",
      ) {
        element.addEventListener("input", (event) => {
          const stylesheet = [...document.styleSheets].find(
            (sheet) => !sheet.href || sheet.href.startsWith(location.origin),
          );
          const rule = [...stylesheet.cssRules].find(
            (r) => r.selectorText === selector,
          );
          if (rule) {
            rule.style.setProperty(property, event.target.value + unit);
          }
        });
      }

      updateCSSVariableForSelector(
        document.getElementById("h1-font-size"),
        "h1",
        "--font-size",
        "rem",
      );
      updateCSSVariableForSelector(
        document.getElementById("h1-line-height"),
        "h1",
        "--line-height",
        "rem",
      );
      updateCSSVariableForSelector(
        document.getElementById("p-font-size"),
        "p",
        "--font-size",
        "rem",
      );
      updateCSSVariableForSelector(
        document.getElementById("p-line-height"),
        "p",
        "--line-height",
        "rem",
      );
    </script>
  </body>
</html>
